{% extends "base.html" %}

{% block title %}Verify OTP - Bulk Email Sender{% endblock %}

{% block content %}
<div class="auth-container">
    <div class="card">
        <div class="card-header bg-info text-white text-center">
            <h4><i class="fas fa-shield-alt"></i> Verify OTP</h4>
        </div>
        <div class="card-body">
            <div class="alert alert-success">
                <i class="fas fa-check-circle"></i>
                We've sent a 6-digit OTP to <strong>{{ email }}</strong>
            </div>
            
            <form method="POST">
                <input type="hidden" name="email" value="{{ email }}">
                
                <div class="mb-3">
                    <label for="otp" class="form-label">Enter OTP:</label>
                    <div class="input-group">
                        <span class="input-group-text"><i class="fas fa-key"></i></span>
                        <input type="text" class="form-control text-center" id="otp" name="otp" required 
                               placeholder="000000" maxlength="6" pattern="[0-9]{6}" 
                               style="font-size: 1.5rem; letter-spacing: 0.5rem;">
                    </div>
                    <div class="form-text">Enter the 6-digit code sent to your email</div>
                </div>

                <div class="d-grid">
                    <button type="submit" class="btn btn-info">
                        <i class="fas fa-check"></i> Verify OTP
                    </button>
                </div>
            </form>
            
            <hr class="my-4">
            
            <div class="text-center">
                <p class="mb-2">Didn't receive the OTP?</p>
                <a href="{{ url_for('forgot_password') }}" class="btn btn-outline-warning btn-sm">
                    <i class="fas fa-redo"></i> Resend OTP
                </a>
                <br><br>
                <a href="{{ url_for('login') }}" class="btn btn-outline-secondary btn-sm">
                    <i class="fas fa-arrow-left"></i> Back to Login
                </a>
            </div>
        </div>
    </div>
    
    <!-- Timer Card -->
    <div class="card mt-4">
        <div class="card-header bg-warning text-white">
            <h6 class="mb-0"><i class="fas fa-clock"></i> OTP Expiry Timer</h6>
        </div>
        <div class="card-body text-center">
            <div id="countdown" class="h4 text-warning">10:00</div>
            <small class="text-muted">Time remaining to enter OTP</small>
        </div>
    </div>
</div>

<script>
// OTP input formatting and validation
document.addEventListener('DOMContentLoaded', function() {
    const otpInput = document.getElementById('otp');
    
    // Auto-focus
    otpInput.focus();
    
    // Only allow numbers
    otpInput.addEventListener('input', function(e) {
        e.target.value = e.target.value.replace(/[^0-9]/g, '');
    });
    
    // Countdown timer (10 minutes)
    let timeLeft = 10 * 60; // 10 minutes in seconds
    const countdownElement = document.getElementById('countdown');
    
    function updateCountdown() {
        const minutes = Math.floor(timeLeft / 60);
        const seconds = timeLeft % 60;
        countdownElement.textContent = `${minutes}:${seconds.toString().padStart(2, '0')}`;
        
        if (timeLeft <= 0) {
            countdownElement.textContent = 'Expired';
            countdownElement.className = 'h4 text-danger';
            clearInterval(timer);
            
            // Show expiry message
            const alertDiv = document.createElement('div');
            alertDiv.className = 'alert alert-danger mt-3';
            alertDiv.innerHTML = '<i class="fas fa-exclamation-triangle"></i> OTP has expired. Please request a new one.';
            document.querySelector('.card-body').appendChild(alertDiv);
            
            // Disable form
            document.querySelector('form button').disabled = true;
        } else if (timeLeft <= 60) {
            countdownElement.className = 'h4 text-danger';
        } else if (timeLeft <= 180) {
            countdownElement.className = 'h4 text-warning';
        }
        
        timeLeft--;
    }
    
    const timer = setInterval(updateCountdown, 1000);
    updateCountdown(); // Initial call
});
</script>
{% endblock %}